<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Air Fingerprint Dashboard</title>
<link rel="stylesheet" href="style.css">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>

<body>

<header>
  <h1>🌍 Air Fingerprint IoT Dashboard</h1>
  <p id="statusMsg">Connecting...</p>
</header>

<div class="alert-banner hidden" id="alertBanner">
  <i class="fas fa-bell"></i> <span id="alertText">Normal</span>
</div>

<main class="dashboard">

  <div class="card">
    <h2><i class="fas fa-wind"></i> Air Quality</h2>
    <div class="value" id="air">--</div>
  </div>

  <div class="card">
    <h2><i class="fas fa-thermometer-half"></i> Temperature</h2>
    <div class="value" id="temp">-- °C</div>
    <canvas id="tempChart" height="100"></canvas>
  </div>

  <div class="card">
    <h2><i class="fas fa-tint"></i> Humidity</h2>
    <div class="value" id="hum">-- %</div>
    <canvas id="humChart" height="100"></canvas>
  </div>

  <div class="card">
    <h2><i class="fas fa-volume-high"></i> Noise</h2>
    <div class="value" id="noise">--</div>
  </div>

  <div class="card alert-card">
    <h2><i class="fas fa-exclamation-triangle"></i> Alert Status</h2>
    <div class="value" id="alertState">--</div>
  </div>

</main>

<footer>
  © 2025 Air Fingerprint Project | IoT Security Monitoring
</footer>

<script>
// ✅ ThingSpeak Details
const channelId = 3126084;
let labelsArr = [];
let tempArr = [];
let humArr = [];

// ✅ Chart Setup
const tempChart = new Chart(document.getElementById("tempChart"), {
  type: "line",
  data: { labels: labelsArr, datasets: [{ data: tempArr, tension: 0.4 }] },
  options: { plugins: { legend: { display: false }}, scales: { x: { display: false }}}
});

const humChart = new Chart(document.getElementById("humChart"), {
  type: "line",
  data: { labels: labelsArr, datasets: [{ data: humArr, tension: 0.4 }] },
  options: { plugins: { legend: { display: false }}, scales: { x: { display: false }}}
});

// ✅ Fetch + Update UI
async function fetchData() {
  try {
    const response = await fetch(
      `https://api.thingspeak.com/channels/${channelId}/feeds.json?results=10`
    );
    const data = await response.json();
    const latest = data.feeds[data.feeds.length - 1];

    let mq = Number(latest.field1);
    let temp = Number(latest.field2);
    let hum = Number(latest.field3);
    let noise = Number(latest.field4);
    let alert = Number(latest.field5);

    // ✅ Value Updates
    document.getElementById("temp").innerText = `${temp} °C`;
    document.getElementById("hum").innerText = `${hum} %`;
    document.getElementById("noise").innerText = noise === 1 ? "HIGH" : "LOW";

    // ✅ Air Quality Classification
    let airStatus =
      mq > 700 ? "POOR" : mq > 400 ? "MODERATE" : "GOOD";
    document.getElementById("air").innerText = airStatus;
    document.getElementById("air").className = `value ${airStatus}`;

    // ✅ Alert State ⚠ One Light System
    const alertText = ["SAFE", "MODERATE", "DANGER"][alert];
    const alertClass = ["safe", "moderate", "danger"][alert];

    document.getElementById("alertState").innerText = alertText;
    document.getElementById("alertText").innerText = alertText;
    document.getElementById("alertBanner").className =
      "alert-banner " + alertClass;

    // ✅ Chart Live Update
    labelsArr.push(new Date().toLocaleTimeString());
    tempArr.push(temp);
    humArr.push(hum);

    if (labelsArr.length > 10) {
      labelsArr.shift();
      tempArr.shift();
      humArr.shift();
    }

    tempChart.update();
    humChart.update();

    document.getElementById("statusMsg").innerText = "LIVE ✅";
  } catch (err) {
    document.getElementById("statusMsg").innerText = "Disconnected ❌";
  }
}

// ✅ Auto Update Every 20 Sec
fetchData();
setInterval(fetchData, 20000);
</script>

</body>
</html>
